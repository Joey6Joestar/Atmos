<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Atmos - Chat</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body class="chat-page">
  <div class="chat-shell">

    <div class="chat-header">
      <div class="chat-title">
        <div class="dot"></div>
        <div>
          <div class="brand">Atmos</div>
          <div class="sub">Describe your party vibe + add a room photo</div>
        </div>
      </div>
      <a class="header-link" href="{{ url_for('splash') }}">Exit</a>
    </div>

    <div id="chatLog" class="chat-log">
      <div class="bubble ai">
        <div class="bubble-label">Atmos</div>
        <div>Drop a room photo and tell me the vibe. I’ll generate the party look and what you’re missing.</div>
      </div>

      {% if filename and party_prompt %}
      <div class="bubble user">
        <div class="bubble-label">You</div>
        <div class="msg">{{ party_prompt }}</div>
        <img class="chat-img" src="{{ url_for('static', filename='uploads/' + filename) }}" alt="Uploaded room">
      </div>

      <div class="bubble ai">
        <div class="bubble-label">Atmos</div>
        {% if generated_filename %}
        <div class="generated-room-wrap">
          <img class="chat-img generated-room" src="{{ url_for('static', filename='generated/' + generated_filename) }}" alt="Transformed room">
        </div>
        {% endif %}
        <div>{{ ai_feedback or 'Generating your transformed room...' }}</div>
      </div>
      {% endif %}
    </div>

{% if success %}
  <div id="toast" class="toast">
    Submitted successfully ✅
  </div>
{% endif %}

<div id="previewRow" class="preview-row hidden">
  <div class="preview-chip">
    <span id="previewName">image.jpg</span>
    <button type="button" id="removeImg" class="x-btn" title="Remove">×</button>
  </div>
  <img id="previewImg" class="mini-preview" alt="Preview">
</div>

<form class="chat-input" method="POST" enctype="multipart/form-data">
  <input id="photoInput" type="file" name="photo" accept="image/*" hidden>

  <label for="photoInput" class="icon-btn">+</label>

  <textarea
    name="partyPrompt"
    class="text-bar"
    rows="1"
    placeholder="Describe the party vibe..."
    required></textarea>

  <button type="submit" class="send-btn" title="Send">→</button>
</form>

<script src="{{ url_for('static', filename='app.js') }}"></script>

</body>
</html>